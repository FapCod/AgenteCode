# ü§ñ Code Review - PR #3360

üìä **Puntaje General**: 68/100 ‚≠ê‚≠ê‚≠ê
Veredicto: **‚õî REQUEST CHANGES**

## üìà Desglose de Puntaje
| Categor√≠a | Puntaje | Peso | Contribuci√≥n |
|-----------|---------|------|--------------|
| Funcionalidad | 4/5 | 20% | 16.0 |
| Robustez | 1/5 | 20% | 4.0 |
| Mantenibilidad | 4/5 | 20% | 16.0 |
| Testabilidad | 4/5 | 15% | 12.0 |
| Escalabilidad | 4/5 | 10% | 8.0 |
| Arquitectura | 4/5 | 15% | 12.0 |
| **TOTAL** | | | **68/100** |

> **Classification**: XS / Medium Risk
> **Reviewer**: AI Auditor (FPININ)
> **Stack Detectado**: Kotlin (.kt)
> **Desarrollador**: extfpinin_belcorp
> **Fecha**: 2026-02-16
> **¬øListo para fusionar?**: NO
---

## üî¥ Problemas Cr√≠ticos (P0 - Blocking)
> *Issues de seguridad, crashes, o violaciones de reglas estrictas. Deben corregirse obligatoriamente.*

1. **[Unsafe Cast - Riesgo de Crash]**
   - **Archivo**: `developmentpath/src/main/kotlin/biz/belcorp/salesforce/modules/developmentpath/features/profile/prepararseesclave/detail/negocio/container/BusinessViewModel.kt` l√≠nea 123
   - **Problema**: Se est√° realizando un casting forzado (`as`) de `info` a `ProfileInfo.DatoPersonaSe` sin validar previamente si el objeto es de ese tipo. Si `getProfileInfoUseCase.getInfo` retorna otra subclase de `ProfileInfo` (ej: `DatoPersonaGz`), la aplicaci√≥n crashear√° con `ClassCastException`.
   - **Riesgo**: Crash en tiempo de ejecuci√≥n si el perfil no es SE (Socias Empresarias).
   - **Tiempo est.**: 5 minutos
   - **C√≥digo actual**:
     ```kotlin
     val infoSe = info as ProfileInfo.DatoPersonaSe
     ```
   - **Soluci√≥n sugerida**:
     ```kotlin
     val infoSe = info as? ProfileInfo.DatoPersonaSe ?: return 
     // O manejar el escenario donde no es DatoPersonaSe
     ```

---

## üü° Problemas Importantes (P1 - High Priority)
> *Problemas de performance, bugs probables o deuda t√©cnica alta.*

Ninguno ‚úÖ

---

## üü¢ Recomendaciones (P2/P3 - Medium/Low)
> *Mejoras de mantenibilidad y buenas pr√°cticas. (Ver Regla 3.3: NO sugerir comentarios/docs/tests extra)*

**P2 - Medium Priority:**
- üí° [Sugerencia] Considerar manejar expl√≠citamente el caso donde `info` no es `DatoPersonaSe` si este ViewModel es compartido o si existe la posibilidad de que otros roles accedan a esta pantalla, para evitar estados inconsistentes (pantalla vac√≠a o errores silenciosos si se usa `return`).

**P3 - Low Priority:**
- ‚ÑπÔ∏è [Naming] `uaPersona` es un nombre claro, pero `uaFromProfile` podr√≠a ser m√°s consistente con el ingl√©s del resto del c√≥digo (`infoSe`).

---

## ‚úÖ Aspectos Positivos
- ‚úÖ Reutilizaci√≥n correcta de l√≥gica en `BusinessUseCase` permitiendo pasar `uaKey` opcional.
- ‚úÖ Extracci√≥n de `uaPersona` al inicio del bloque reduce la duplicaci√≥n de accesos en llamadas posteriores.
- ‚úÖ Uso de Nullable types (`LlaveUA?`) en los par√°metros del UseCase mantiene compatibilidad con c√≥digo existente.

---

## üìã Plan de Acci√≥n
**Antes de mergear (Requerido):**
- [ ] üî¥ Corregir [Unsafe Cast] (5 min)

**Este sprint (High priority):**
- [ ] Ninguno

**Backlog (Low priority):**
- [ ] Revisar [Sugerencia P2]

---

## üéì Aprendizajes Clave
- ‚ùå **Evitar**: Casteos forzados (`as`) sin comprobaci√≥n de tipo (`is`) o manejo seguro (`as?`).
- ‚úÖ **Preferir**: Smart Casts de Kotlin (`if (x is T)`) o Safe Casts (`as?`).

---

## üìù Sugerencia de Pr√≥ximo Commit
 `[SDP-160922] -FIX Corregir unsafe cast en BusinessViewModel`

---

## üìã Resumen del PR
**¬øQu√© hace este PR?**
Habilita la capacidad de consultar informaci√≥n de campa√±as, retenci√≥n, estatus y capitalizaci√≥n utilizando una `LlaveUA` espec√≠fica (obtenida del perfil de la persona) en lugar de depender √∫nicamente de la `LlaveUA` de la sesi√≥n actual. Esto se logra modificando `BusinessUseCase` para aceptar un `uaKey` opcional y actualizando `BusinessViewModel` para pasar la UA de la socia empresaria.

**Archivos principales modificados:**
- [MODIFY] `BusinessUseCase.kt` - M√©todos actualizados para aceptar `uaKey` opcional.
- [MODIFY] `BusinessViewModel.kt` - Obtenci√≥n y uso de `uaPersona` en lugar de sesi√≥n.
- [MODIFY] `ProfileInfoMapper.kt` - Mapeo del campo `llaveUA`.
- [MODIFY] `ProfileInfo.kt` - Propiedad `llaveUA` agregada a la entidad.

**¬øQu√© Podria impactar?**
La visualizaci√≥n de datos en el detalle de "Prepararse es Clave" para perfiles que no sean de la sesi√≥n actual (ej: al ver detalle de una socia).

**Impacto:**
- ARQUITECTURA

> _Ref: Consultar Ap√©ndice D para referencias oficiales espec√≠ficas de cada lenguaje (Kotlin Coding Conventions, Android Architecture Guide)_
